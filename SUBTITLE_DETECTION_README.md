# ğŸ¬ è§†é¢‘å­—å¹•æ£€æµ‹åŠŸèƒ½

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

è‡ªåŠ¨æ£€æµ‹è§†é¢‘æ˜¯å¦åŒ…å«å­—å¹•ï¼Œæ”¯æŒï¼š
- âœ… **è½¯å­—å¹•**ï¼ˆå†…åµŒå­—å¹•è½¨é“ï¼Œå¦‚ SRTã€ASSï¼‰- FFprobe æ£€æµ‹
- âœ… **ç¡¬å­—å¹•**ï¼ˆç”»é¢ä¸­çš„æ–‡å­—ï¼‰- PaddleOCR æ£€æµ‹
- âœ… å¼‚æ­¥å¤„ç†ï¼Œä¸é˜»å¡ä¸Šä¼ 
- âœ… GPU åŠ é€Ÿæ”¯æŒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
cd backend/video
pip install paddleocr>=2.8.0 paddlepaddle-gpu>=3.0.0  # GPU ç‰ˆæœ¬ï¼ˆæ¨èï¼‰
# æˆ–
pip install paddleocr>=2.8.0 paddlepaddle>=3.0.0      # CPU ç‰ˆæœ¬
```

**âœ¨ ä½¿ç”¨ PP-OCRv5 è½»é‡æ¨¡å‹**ï¼šé€Ÿåº¦æå‡ 30%+ï¼Œæ¨¡å‹ä½“ç§¯å‡å° 40%ï¼

### 2. æ•°æ®åº“è¿ç§»
```bash
python manage.py migrate
```

### 3. æµ‹è¯•
```bash
python test_subtitle_detection.py /path/to/video.mp4
```

### 4. é›†æˆï¼ˆå¯é€‰ï¼‰
åœ¨ `backend/video/videos/tasks.py` çš„ `process_video` å‡½æ•°æœ«å°¾æ·»åŠ ï¼š
```python
try:
    from .tasks import detect_video_subtitle
    detect_video_subtitle.delay(video_id)
except Exception as e:
    logger.warning(f"è§¦å‘å­—å¹•æ£€æµ‹å¤±è´¥: {e}")
```

## ğŸ“Š æ€§èƒ½

| æ£€æµ‹ç±»å‹ | é€Ÿåº¦ (GPU) | é€Ÿåº¦ (CPU) | å‡†ç¡®ç‡ |
|---------|-----------|-----------|--------|
| è½¯å­—å¹•   | < 1 ç§’    | < 1 ç§’    | 100%   |
| ç¡¬å­—å¹• (PP-OCRv5) | 0.5-2 ç§’ | 2-8 ç§’ | 90-97% |

**PP-OCRv5 æ€§èƒ½æå‡**ï¼šç›¸æ¯” v3 ç‰ˆæœ¬ï¼Œé€Ÿåº¦æå‡ 30%+ï¼Œå‡†ç¡®ç‡æå‡ 5%ï¼

## ğŸ“ ç›¸å…³æ–‡ä»¶

```
backend/video/
â”œâ”€â”€ videos/
â”‚   â”œâ”€â”€ subtitle_detector.py               # æ ¸å¿ƒæ£€æµ‹é€»è¾‘ (PP-OCRv5)
â”‚   â”œâ”€â”€ tasks.py                           # Celery ä»»åŠ¡
â”‚   â””â”€â”€ models.py                          # æ•°æ®åº“æ¨¡å‹
â”œâ”€â”€ test_subtitle_detection.py              # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ PP_OCRV5_CONFIG.md                      # PP-OCRv5 é…ç½®è¯´æ˜ â­
â”œâ”€â”€ QUICK_START_SUBTITLE.md                 # å¿«é€Ÿå¼€å§‹
â””â”€â”€ requirements.txt                        # ä¾èµ–ï¼ˆPP-OCRv5ï¼‰
```

## ğŸ”§ æŠ€æœ¯æ–¹æ¡ˆ

### æ£€æµ‹æµç¨‹
```
è§†é¢‘ä¸Šä¼  â†’ è½¬ç  â†’ å­—å¹•æ£€æµ‹
                    â”œâ”€ 1. FFprobe æ£€æµ‹è½¯å­—å¹•ï¼ˆå¿«ï¼‰
                    â””â”€ 2. PaddleOCR æ£€æµ‹ç¡¬å­—å¹•ï¼ˆæ…¢ï¼‰
                         â”œâ”€ å‡åŒ€é‡‡æ · 10 å¸§
                         â”œâ”€ åªæ£€æµ‹åº•éƒ¨ 30% åŒºåŸŸ
                         â””â”€ ç»Ÿè®¡åˆ¤æ–­
```

### æ•°æ®åº“å­—æ®µ
- `has_subtitle`: æ˜¯å¦æœ‰å­—å¹•
- `subtitle_type`: 'none' | 'soft' | 'hard'
- `subtitle_language`: 'zh' | 'en' | ...
- `subtitle_detected_at`: æ£€æµ‹æ—¶é—´

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

1. **å†…å®¹å®¡æ ¸**: ä¼˜å…ˆå®¡æ ¸æœ‰å­—å¹•çš„è§†é¢‘
2. **ç”¨æˆ·ä½“éªŒ**: æ˜¾ç¤º"æœ‰å­—å¹•"æ ‡è¯†
3. **è§†é¢‘ç­›é€‰**: æŒ‰å­—å¹•ç­›é€‰è§†é¢‘
4. **æ•°æ®åˆ†æ**: ç»Ÿè®¡å­—å¹•è§†é¢‘å æ¯”

## ğŸ“– è¯¦ç»†æ–‡æ¡£

- [PP-OCRv5 é…ç½®è¯´æ˜](backend/video/PP_OCRV5_CONFIG.md) - PP-OCRv5 è½»é‡æ¨¡å‹é…ç½® â­
- [å¿«é€Ÿå¼€å§‹](backend/video/QUICK_START_SUBTITLE.md) - 5 åˆ†é’Ÿå¿«é€Ÿé›†æˆ
- [æµ‹è¯•è„šæœ¬](backend/video/test_subtitle_detection.py) - å‘½ä»¤è¡Œæµ‹è¯•å·¥å…·

## â“ å¸¸è§é—®é¢˜

**Q: éœ€è¦ GPU å—ï¼Ÿ**  
A: ä¸éœ€è¦ï¼Œä½† GPU å¯ä»¥æå‡ 3-5 å€é€Ÿåº¦ã€‚

**Q: ä¼šå½±å“ä¸Šä¼ é€Ÿåº¦å—ï¼Ÿ**  
A: ä¸ä¼šï¼Œå­—å¹•æ£€æµ‹æ˜¯å¼‚æ­¥ä»»åŠ¡ã€‚

**Q: æ”¯æŒå“ªäº›è¯­è¨€ï¼Ÿ**  
A: ç›®å‰ä¸»è¦æ”¯æŒä¸­æ–‡ï¼Œå¯é…ç½®æ”¯æŒå…¶ä»–è¯­è¨€ã€‚

**Q: å¦‚ä½•æ‰¹é‡æ£€æµ‹å·²æœ‰è§†é¢‘ï¼Ÿ**  
A: 
```python
from videos.models import Video
from videos.tasks import detect_video_subtitle

for video in Video.objects.filter(subtitle_detected_at__isnull=True):
    detect_video_subtitle.delay(video.id)
```

## ğŸ¯ ä¸‹ä¸€æ­¥

1. âœ… å®‰è£… PaddleOCRï¼ˆPP-OCRv5 GPU ç‰ˆæœ¬æ¨èï¼‰
2. âœ… è¿è¡Œæ•°æ®åº“è¿ç§»
3. âœ… æµ‹è¯•åŠŸèƒ½
4. â³ é›†æˆåˆ°ä»£ç ï¼ˆå¯é€‰ï¼‰
5. â³ å‰ç«¯æ˜¾ç¤ºå­—å¹•æ ‡è¯†ï¼ˆå¯é€‰ï¼‰

## ğŸ“ æ³¨æ„äº‹é¡¹

- é¦–æ¬¡è¿è¡Œä¼šä¸‹è½½ PP-OCRv5 æ¨¡å‹ï¼ˆçº¦ 7MBï¼Œæ¯” v3 å° 40%ï¼‰
- GPU ç‰ˆæœ¬éœ€è¦ CUDA å’Œ cuDNN
- ç¡®ä¿ FFmpeg å·²å®‰è£…ï¼š`ffmpeg -version`
- PP-OCRv5 æ€§èƒ½æå‡ 30%+ï¼Œæ¨èä½¿ç”¨ï¼

---

**å®ç°å®Œæˆï¼ä½¿ç”¨ PP-OCRv5 è½»é‡æ¨¡å‹ï¼Œæ€§èƒ½æå‡ 30%+ï¼** ğŸ‰

æŸ¥çœ‹ [PP-OCRv5 é…ç½®è¯´æ˜](backend/video/PP_OCRV5_CONFIG.md) äº†è§£æ›´å¤šä¼˜åŒ–é€‰é¡¹ã€‚
